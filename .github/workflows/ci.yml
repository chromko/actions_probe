name: Publish Docker
on: [push]
    # branches:
    #   - master
jobs:
  build and deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Build and publishdocker image
      uses: "pangzineng/Github-Action-One-Click-Docker@master"
      with:
        env:
          - DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          - DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}

    - name: deploy to stage
      uses: stoe/actions/ansible-playbook@master
      with:
        args: infrastructure/playbooks/sample/deploy.yml -i environments/stage/static_hosts -e app_docker_image=$GITHUB_REPOSITORY -e app_docker_tag=$GITHUB_SHA
